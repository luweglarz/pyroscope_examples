---
  version: '3.9'
  services:
    pyroscope:
      image: grafana/pyroscope
      ports:
        - '4040:4040'
      
    cpp-resource-consuming:
      build: ./cpp_app
      ports:
        - '8080:8080'
    
    java-resource-consuming:
      build: ./java_app
  
    grafana-agent:
      image: 'grafana/alloy:v1.5.0'
      privileged: true
      user: root
      pid: 'host'
      volumes:
        - '/var/run/docker.sock:/var/run/docker.sock'
        - ./config.alloy:/config.alloy
      ports:
        - '12345:12345'
      command:
        - run
        - ./config.alloy
        - --storage.path=/tmp/alloy
        - --server.http.listen-addr=0.0.0.0:12345
        - --server.http.ui-path-prefix=/
        - --stability.level=public-preview

